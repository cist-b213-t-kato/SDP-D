var DQMessageView=(function(){function a(b){this.observer=b}a.prototype.draw=function(e){var b=this.observer.getX();var j=this.observer.getY();var g=this.observer.getVisibleMessage();e.font=this.observer.getFont();e.fillStyle=this.observer.getFillStyle();var d=0;while(g.length>0){var c;for(var f=1;true;f++){c=g.substr(0,f);if(c.lastIndexOf("#")!==-1){c=g.substr(0,f-1);g=g.substr(f);break}else{if(e.measureText(c).width>this.observer.getLineWidth()){c=g.substr(0,f-1);g=g.substr(f-1);break}else{if(g.length===c.length){g="";break}}}}e.fillText(c,b,j+(this.observer.getBetween()*d));d++}};return a})();var MessageReader=(function(){function a(b,d,c){this.observer=b;this.message=d;this.autoAdvance=c;this.count=0}a.prototype.calc=function(){if(this.count%3===0){this.observer.addVisibleMessage(this.message.substring(0,1));this.message=this.message.substring(1);if(this.message.length===0){this.observer.ReadEnd()}}this.count++};a.prototype.skip=function(){this.observer.addVisibleMessage(this.message);this.observer.ReadEnd()};a.prototype.isAutoAdvance=function(){return this.autoAdvance};return a})();var DQMessage=(function(){function a(c,g,b,f,e,d){this.x=c;this.y=g;this.between=f;this.font=e;this.fillStyle=d;this.lineWidth=b;this.count=0;this.advanceFlag=false;this.reader=null;this.eventList=new Array();this.visibleMessage="";this.view=new DQMessageView(this);this.advancePermit=true}a.prototype.calc=function(){if(this.reader!==null){this.reader.calc()}if(!this.advanceFlag){return}this.advanceFlag=false;if(this.reader!==null){this.reader.skip()}else{if(this.eventList.length>0){(this.eventList.shift())()}}};a.prototype.graph=function(b){this.view.draw(b)};a.prototype.countUp=function(){this.count++};a.prototype.advance=function(){if(!this.setAdvancePermit){return}this.advanceFlag=true};a.prototype.addMessage=function(c,b){var d=this;if(b===void 0){b=false}this.eventList.push(function(){d.reader=new MessageReader(d,c,b)})};a.prototype.addEvent=function(b){this.eventList.push(b)};a.prototype.ReadEnd=function(){var b=this.reader.isAutoAdvance();this.reader=null;if(b){this.advance()}};a.prototype.addVisibleMessage=function(b){this.visibleMessage+=b};a.prototype.clearVisibleMessage=function(){this.visibleMessage=""};a.prototype.isReading=function(){return this.reader!==null};a.prototype.getVisibleMessage=function(){return this.visibleMessage};a.prototype.getX=function(){return this.x};a.prototype.getY=function(){return this.y};a.prototype.getLineWidth=function(){return this.lineWidth};a.prototype.getBetween=function(){return this.between};a.prototype.getFont=function(){return this.font};a.prototype.getFillStyle=function(){return this.fillStyle};a.prototype.isAdvancePermit=function(){return this.advancePermit};a.prototype.isEmpty=function(){return this.eventList.length===0};a.prototype.setX=function(b){this.x=b};a.prototype.setY=function(b){this.y=b};a.prototype.setAdvancePermit=function(b){this.advancePermit=b};return a})();var MessageWindow=(function(){function a(c,d,b){this.x=c;this.y=d;this.message=new DQMessage(c,d+30,b,30,"24pt 'dqf'","rgb(255,255,255)");this.count=0}a.prototype.calc=function(){this.message.calc()};a.prototype.graph=function(b){this.message.graph(b)};a.prototype.countUp=function(){this.count++};a.prototype.getMessageObject=function(){return this.message};return a})();var link=document.createElement("link");link.href="dqmw/font.css";link.rel="stylesheet";link.type="text/css";var h=document.getElementsByTagName("head")[0];h.appendChild(link);var canvas;var ctx;var messageWindow;canvas=document.getElementById("dqmw");ctx=canvas.getContext("2d");messageWindow=new MessageWindow(0,0,canvas.width);canvas.addEventListener("touchend",function(){messageWindow.getMessageObject().advance()});setInterval(function(){messageWindow.calc();ctx.clearRect(0,0,canvas.width,canvas.height);messageWindow.graph(ctx);messageWindow.countUp()},1000/30);function addMessage(b,a){if(a===void 0){a=false}messageWindow.getMessageObject().addMessage(b,a)}function addTask(a){messageWindow.getMessageObject().addEvent(a)}function advance(){messageWindow.getMessageObject().advance()}function clearMessage(a){if(a===void 0){a=true}messageWindow.getMessageObject().addEvent(function(){messageWindow.getMessageObject().clearVisibleMessage();if(a){messageWindow.getMessageObject().advance()}})};